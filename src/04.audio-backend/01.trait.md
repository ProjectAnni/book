# Trait Backend

此处描述 `Rust` 实现的 `anni-backend` 的基本 `Trait`。其他语言可模仿设计类似接口。

```rust
#[async_trait]
pub trait Backend {
    // 获取可用专辑 album_id 的集合
    async fn albums(&self) -> Result<HashSet<Cow<str>>, BackendError>;

    // 获取音频
    async fn get_audio(&self, album_id: &str, disc_id: u8, track_id: u8) -> Result<BackendReaderExt, BackendError>;

    // 获取封面
    async fn get_cover(&self, album_id: &str, disc_id: Option<u8>) -> Result<BackendReader, BackendError>;

    // 重新加载
    async fn reload(&mut self) -> Result<(), BackendError>;
}
```

其中获取返回的类型由 `BackendReader` 和 `BackendReaderExt` 描述：

```rust
pub type BackendReader = Pin<Box<dyn AsyncRead + Send>>;

pub struct BackendReaderExt {
    /// 文件扩展名
    pub extension: String,
    /// 文件大小
    pub size: usize,
    /// 音频长度
    pub duration: u64,
    /// 读取文件内容的 Reader
    pub reader: BackendReader,
}
```