# 两步验证（2fa）

## 特性定义

- `2fa`：表示服务端允许两步验证
- `2fa_enforced`：表示服务端强制启用两步验证

## 适用范围

- 用户注册（`POST /api/user/register`）
- 用户登录（`POST /api/user/login`）
- 用户注销（`POST /api/user/revoke`）

TODO: 列举出用到 `2FA` 的所有位置

## 请求参数

| 参数名       | 类型     | 详情                                                            |
| ------------ | -------- | --------------------------------------------------------------- |
| `2fa_secret` | `string` | 两步验证的 `Secret`，注册时由客户端生成，验证成功后发送至服务端 |
| `2fa_code`   | `\d{6}`  | 两步验证的代码                                                  |

## 影响结构

当 `2fa_enforced` 启用时，以下所有新增参数均为 `Required`。

### 用户注册

```typescript
interface UserLoginBody {
  // ...
  "2fa_code"?: string;
}
```

### 用户登录

```typescript
interface UserRegisterBody {
  // ...
  "2fa_secret"?: string;
}

interface UserInfo {
  // ...
  "2fa_enabled"?: boolean;
}
```

### 用户注销

```typescript
interface UserRevokeBody {
  "2fa_code"?: string;
}
```

## 错误列表

| 错误代码 | 详情                       |
| -------- | -------------------------- |
| `202000` | 用户或服务端未启用两步验证 |
| `202001` | 两步验证代码错误           |
| `202002` | 两步验证 `Secret` 非法     |
| `202003` | 两步验证已达尝试上限       |
| `202004` | 未提供两步验证代码         |
